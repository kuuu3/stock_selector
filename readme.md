選股系統

1. 資料來源

多語言財經新聞：整合各語言來源的財經新聞（如中文、英文等），擴大資訊涵蓋範圍並降低單一語言偏誤。透過爬蟲及API即時收集新聞標題與全文，將不同語言的新聞內容轉換為統一的語意表示，方便後續分析。

ETF持股變動：監控主要交易所買賣基金（ETF）的持倉名單定期披露，記錄各ETF對成分股權重的增減變化。這類資料反映市場資金對特定股票或產業的偏好轉移，例如某股票若連續數期被多支ETF增持，可能顯示長期資金看好。

法人買賣資料：蒐集市場主力（如投信、外資、自營商等法人）的每日買賣超統計，追蹤大型機構資金流向。將法人在個股上的淨買入或賣出量作為特徵，結合交易金額評估「聰明資金」對股價的潛在影響。

社群媒體輿情：利用API追蹤Twitter、股票論壇等社群平台上的討論熱度與情緒傾向。透過關鍵詞計數、情感分析等方法量化市場輿情，例如監測特定股票提及次數激增或情緒轉為極端正面/負面，作為短期情緒指標。

市場行情與基本數據：包含股票歷史日價量數據、技術指標及公司基本面資料。記錄股價走勢、成交量、財務比率等，並預先計算移動平均線、相對強弱指標等技術指標供模型使用。基本面資訊如財報數據則作為輔助特徵，提供公司長期價值參考。

2. 前處理

新聞事件抽取：對收集到的新聞文本進行NLP解析，識別重要財經事件的要素。例如透過命名實體識別找出涉及的公司、人物和數值，並運用關係抽取將事件動態結構化（如「某公司公佈併購計劃」）。結合大型語言模型搭配檢索增強生成（RAG）的方法，從新聞內容中自動抽取關鍵實體及關聯關係，生成事件的摘要描述供模型引用
。

新聞情緒分析：對新聞文本進行情感傾向分類與語意表示。使用金融領域預訓練模型如FinBERT對新聞進行編碼，提取新聞的語境向量與情緒分數。FinBERT相較一般情緒分析模型，更能捕捉財經文本中特有的術語細微差異和上下文洞察
。此外，可將新聞情緒劃分為正面、負面、中性三類，或以LLM結合自身知識庫判斷新聞對相關股票的影響強度。

市場時序數據處理：針對股價等時間序列數據進行清洗與特徵工程。首先進行市場狀態偵測，例如運用移動平均趨勢或隱馬爾可夫模型判斷當前屬於牛市、熊市或震盪市等 regime，並以此標記每筆樣本的所處狀態供模型參考。其次實施異常值處理，排除股票拆分、暫停交易等導致的價量異常點，透過拉距法或季節性分解去除極端值影響。接著計算週期型技術指標，捕捉長短周期的市場波動特徵（例如長週期移動平均與短週期移動平均交叉、週期性震盪指標等），強化模型對週期循環股的辨識能力。同時將大盤指數或產業指數作為上下文特徵加入，提供個股所處的宏觀市場背景（如大盤趨勢方向）。

社群輿情數據處理：清理並分析社交媒體文本，過濾掉spam及無關訊息。採用情感詞典或深度學習分類器對推文、論壇帖子定調（正向/負向），並統計每日輿情指數。例如計算每天相關貼文數量及平均情緒分值，作為反映市場情緒熱度的時間序列特徵。同時留意社群上異常趨勢（如某公司話題討論度暴增），異常輿情事件可單獨標記供模型訓練辨識。

資金流動數據處理：針對ETF持倉和法人買賣資料進行特徵提取。對ETF持股異動，計算每支股票被多少ETF增持或減持，以及變動比例；也可對比該ETF整體資產變化以得出相對變動幅度。對法人交易數據，整理每日三大法人的淨買超金額及股數，並計算近幾日累積買超排名。為平滑短期噪音，可對這些序列特徵取移動平均或指數加權。最終將資金流向相關特徵與價格、新聞特徵對齊（例如以日為頻率），在模型中融合作為先行指標訊號。

3. 標籤設計

三元分類標籤：將預測目標設計為三類漲跌平訊號，以更細緻地描述未來走勢方向。根據未來一段時間（如1週或1個月）的股價變化率設定標籤：漲（+1）、跌（-1）、盤整或變動微小（0）。例如若未來收益率＞0則標記為+1，＜0則為-1，而介於-0.5%～+0.5%之間變動可視為0類別。此三元分類標籤能讓模型區分明顯趨勢與橫盤狀態，避免過度預測小幅波動為漲跌。

多階段報酬區間分類：引入分級回報率預測標籤，以預測漲跌的同時估計漲跌幅大小。將未來報酬率切分為多個區間級別，例如：負收益、0%～+1%、+1%～+5%、大於+5%等多檔區間，為每筆樣本貼上對應級別的類別標籤。這種多階段分類使模型有能力識別潛在漲幅的強弱，不僅判斷方向也評估幅度。模型輸出時可以同時給出「方向+幅度區間」的預測結果，有助於投資決策時調整持倉比重。必要時亦可將方向分類與區間分類作為多任務聯合學習目標，讓模型共享特徵表示，同時優化方向判斷和幅度預估的準確度。

4. 模型設計

多模態Transformer模型：採用文本與時間序列數據融合的多模態Transformer架構。為每種資料模態配置專門編碼器：例如使用預訓練語言模型（如FinBERT或Financial GPT）編碼新聞文本，獲得文本語義向量表示；同時以Transformer或LSTM編碼歷史價格及技術指標序列，提取時間序列模式特徵。接著在融合階段引入跨模態注意力機制，使模型能同時關注文字與數值兩方面最相關的資訊
。這種設計允許模型學習新聞事件與股價波動之間的內在聯繫，透過注意力權重動態調節兩種訊息對預測的影響比例，從而提高預測的準確度和魯棒性。

融合注意力的集成模型：另一種考量是使用集成學習架構，將不同模組的優勢結合以提升模型泛化能力。具體作法是分別訓練「文本模型」與「時間序列模型」兩個子模型：前者專注於新聞、社群等非結構化文本訊息（例如使用Transformer提取新聞情緒向量），後者專注於價格與技術指標等結構化數據（例如用LSTM捕捉時間序列趨勢）。在預測階段，透過注意力融合機制將兩個子模型的預測結果加權合併：即以可學習的權重或注意力網絡，根據當時市場情境自適應地調整文本訊息與技術訊號的貢獻度，生成最終綜合得分。這種集成方式提高模型穩健性，當任一模態數據失效或噪音較大時，另一模態仍可提供支撐，降低單一模型偏誤風險。

5. 訓練與驗證

Walk-Forward走勢前移訓練：採用逐步滾動的時間窗訓練驗證法，模擬實際投資情境來評估模型表現。將歷史數據依時間順序劃分為多個連續區段：首先用較早期資料訓練模型，接著用隨後的一段資料驗證，然後將窗口向前滑動（加入較新資料並移除最舊部分）重新訓練，再驗證下一時段。如此Walk-forward方式確保訓練集總是發生在驗證集之前，避免未來資訊洩漏，同時能觀察模型隨時間推移在不同市場時期的穩定度。最終彙總多次前移驗證的結果以評估模型在實戰中的綜合表現。

牛熊市標記與訓練調整：在模型訓練時納入市場 regime 因素，提升模型對不同市況的適應力。為每個樣本附加牛市/熊市標記（或更多細分如震盪市），這可由大盤趨勢指標或波動率水準判定。模型可將此標記作為一項輸入特徵，使其在學習時區分不同市場狀態下的模式差異。此外，訓練過程可對不同regime下的樣本採用分層批次或調整損失權重，確保模型在牛市與熊市情境下都有足夠學習。必要時亦可訓練兩套子模型分別專門針對牛市和熊市，再依實際市況動態選用，從而提高極端行情下的預測可靠度。

風險控制與回撤預測：將風險預估納入模型訓練體系，在追求報酬同時控制潛在風險。新增一個子模型或多任務學習分支，專門預測個股未來可能的最大回撤幅度或波動度。這可透過歷史高低點計算各樣本在預測區間內的回撤作為訓練標的。模型學習此風險預測任務，有助於在預測股價上漲的同時給出風險評估。最終在選股決策時，可將回撤風險作為約束條件：例如過濾掉預期回撤風險過高的股票，或結合風險調整後的收益指標挑選股票，實現報酬與風險的權衡。模型驗證時也引入風險評估指標（如最大回撤、夏普比率），確保所選策略在歷史數據上風險可控。

模型調優與驗證評估：訓練過程中運用Early Stopping、防過擬合措施等確保模型泛化能力。透過時間切片交叉驗證評估不同時間段的性能，並使用多元指標衡量模型效果：分類問題上關注精確度、召回率及分類錯誤分布；在投資回報上則計算累計報酬、年化報酬率、夏普比率等模擬交易績效。同時檢查模型在各市場階段（多頭、空頭）的表現差異，以發現潛在弱點並持續調整特徵或模型結構。

6. 選股流程

穩健得分排序：根據模型對每支股票的預測結果計算綜合評分，並結合波動風險進行調整形成排序。比如對分類模型，可使用預測為上漲的機率或信心分數作為初步分數；對回報區間預測模型，可取預期報酬的中位數或期望值作分數。隨後引入波動率作為懲罰因子，降低高風險股票的排名影響──例如將分數除以近期歷史波動率，或採用夏普比率概念以「預期收益/風險」作為最終排序依據。如此排序機制偏好穩健上漲型股票，避免僅因高潛在報酬但高風險的標的佔據前列，提升選股結果的穩定性。

產業多樣性限制：在選股名單中加入產業分散化約束，避免過度集中於單一產業而承擔非系統性風險。實施方式包括：限定最終選出的股票需分屬於不同產業板塊（例如不超過一定比例的股票來自同一行業），或者在排序過程中對已選入的產業增加權重懲罰，使得後續選股自動偏向尚未覆蓋的行業。也可以採取分組排名法，先按行業對股票進行分類，在每個行業內選出排名前列的股票候選，再匯總不同行業的候選組成最終投資組合。這確保所選股票組合具備行業多元性，以降低單一產業黑天鵝事件對整體組合的衝擊。

最低流動性濾網：為確保選出的股票具有足夠的市場交易深度，在排序結果中剔除流動性不足的標的。設定明確的流動性指標門檻，例如日均成交額、日均成交量或市值規模等。如果股票的流動性低於門檻，則即使模型評分較高也不納入投資清單，以避免實務交易中可能出現的買賣困難和高沖擊成本。流動性濾網可結合穩健排序同時應用，如先過濾掉不達流動性要求的股票，再從剩餘池中按調整後分數選取Top N股票。此步驟確保模型輸出的選股名單具備實際可交易性。

選股決策與調整：綜合以上步驟生成的初選名單，最後可由人工或額外規則進行覆核調整。例如檢查選股是否與最新重大消息相矛盾，或者排除存在明顯基本面缺陷的公司。最終確認的股票清單即可用於構建投資組合，並定期（如每週或每月）按照模型流程重新平衡調整持股，以適應最新資訊。

7. 輸出與呈現

重要新聞摘要：系統對每檔入選股票提供相關關鍵資訊的摘要說明，包括近期驅動股價的重大事件和新聞情緒概況。例如列出該股票近期的幾則重要新聞標題及摘要（如財報、公佈利多利空、產業新聞等），並註明這些事件可能帶來的影響方向。新聞摘要可由模型自動產生：透過事件抽取結果搭配LLM生成精簡描述，讓使用者快速瞭解每支股票「為何被選中」。這有助於提升模型決策的透明度，使投資者在採納建議前能參考相關資訊背景。

預測信心區間：在呈現預測結果時提供模型的不確定性估計，以利風險評估。對於分類預測，可給出模型對各類別的機率分佈（例如上漲60%、下跌20%、盤整20%），將最高機率對應的類別作為結論並標示信心程度。對於回報區間預測，則可提供預期報酬的信心區間（例如「下週預期報酬+3%，95%信心水平區間為-1%～+7%」）。信心區間可利用模型ensemble或統計方法估計。此輸出讓使用者瞭解模型預測的穩定性，例如預測區間很寬表示不確定性高，投資時應更謹慎。

視覺化解釋 (SHAP分析)：採用SHAP等模型解釋工具，生成每檔股票預測的因素貢獻圖。透過SHAP值量化各特徵對最終預測分數的正負向影響，並以長條圖或瀑布圖直觀呈現。使用者可以看到例如：「近期新聞情緒+0.3提升了預測分數，高估值財務比-0.1拉低了預測」等資訊。除了數值特徵貢獻，也可視覺化新聞文本的重要片段（如高亮新聞中對模型決策影響最大的關鍵詞句）。這種視覺化解釋增強了模型的可解釋性，有助於使用者了解模型的判斷依據是否合理，也便於發現模型可能的錯誤邏輯（如過度依賴某無關特徵）並進一步改進。

報表與介面：將上述資訊整合到使用者介面中，以清晰易讀的形式呈現。例如儀表板展示選股名單、每檔股票的預測上漲機率、信心區間，以及點擊可展開查看新聞摘要與SHAP分析圖表。報表亦可匯出選股列表及相關數據供記錄。整體介面強調重點突出、色彩標示風險程度，確保使用者在有限時間內抓取關鍵訊息並輔助投資決策。

